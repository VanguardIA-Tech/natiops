datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

enum SyncStatus {
  PENDING
  RUNNING
  SUCCESS
  FAILED
}

enum SyncType {
  FULL
}

enum HoldStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}

model Product {
  id                     String   @id @default(uuid())
  externalId             String   @unique
  idProduto              Int?     @map("IdProduto")
  name                   String   @map("Produto")
  idGradeProduto         Int?     @map("IdGradeProduto")
  idGradeProdutoEstoque  Int?     @map("IdGradeProdutoEstoque")
  cor                    String?  @map("Cor")
  tamanho                String?  @map("Tamanho")
  grupo                  String?  @map("Grupo")
  marca                  String?  @map("Marca")
  colecao                String?  @map("Colecao")
  quantidade             Int?     @map("Quantidade")
  quantidadeReal         Int?     @map("QuantidadeReal")
  quantidadeComprometida Int?     @map("QuantidadeComprometida")
  valor                  Float?   @map("Valor")
  valorCusto             Float?   @map("ValorCusto")
  stockTotal             Int      @default(0)
  reservedStock          Int      @default(0)
  idArmazenador          Int?     @map("IdArmazenador")
  armazenador            String?  @map("Armazenador")
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  holds                  Hold[]
}

model CatalogItem {
  id              String   @id @default(uuid())
  externalId      String   @unique
  referencia      String?  @unique
  descricaoFabrica String?
  status          String?
  unidadeMedida   String?
  fotos           Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Hold {
  id          String     @id @default(uuid())
  product     Product    @relation(fields: [productId], references: [id])
  productId   String
  email       String
  quantity    Int
  expiresAt   DateTime
  status      HoldStatus @default(ACTIVE)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model SyncRun {
  id             String     @id @default(uuid())
  type           SyncType
  status         SyncStatus @default(PENDING)
  createdAt      DateTime   @default(now())
  startedAt      DateTime?
  finishedAt     DateTime?
  currentPage    Int        @default(0)
  currentItemId  String?
  errorMessage   String?
  auditEntries   SyncAudit[]
  checkpoints    SyncCheckpoint[]
}

model SyncCheckpoint {
  id         String   @id @default(uuid())
  syncRun    SyncRun? @relation(fields: [syncRunId], references: [id])
  syncRunId  String?
  type       SyncType
  page       Int      @default(0)
  updatedAt  DateTime @updatedAt

  @@unique([type])
}

model SyncAudit {
  id         String   @id @default(uuid())
  syncRun    SyncRun  @relation(fields: [syncRunId], references: [id])
  syncRunId  String
  externalId String
  action     String
  payload    Json
  hash       String
  createdAt  DateTime @default(now())
}
